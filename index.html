import React, { useState, useEffect } from 'react';

// Assume Tailwind CSS is available in the environment

// Data structure for an expense entry
interface ExpenseEntry {
  month: string;
  lingeshwar: number | '';
  vani: number | '';
  ruchika: number | '';
  rishi: number | '';
  total: number;
}

// Family members
const familyMembers = [
  'Akkela Lingeshwar',
  'Akkela Vani',
  'Akkela Ruchika',
  'Akkela Rishi',
];

function App() {
  // State to hold the expense data
  const [expenses, setExpenses] = useState<ExpenseEntry[]>([]);
  // State for the current month's input
  const [currentMonth, setCurrentMonth] = useState('');
  const [currentExpenses, setCurrentExpenses] = useState({
    lingeshwar: '' as number | '',
    vani: '' as number | '',
    ruchika: '' as number | '',
    rishi: '' as number | '',
  });
  // State for editing
  const [editingIndex, setEditingIndex] = useState<number | null>(null);
  const [editedExpenses, setEditedExpenses] = useState<ExpenseEntry | null>(null);

  // Calculate total expenses for an entry
  const calculateTotal = (entry: any): number => {
    const total = (parseFloat(entry.lingeshwar || '0') || 0) +
                  (parseFloat(entry.vani || '0') || 0) +
                  (parseFloat(entry.ruchika || '0') || 0) +
                  (parseFloat(entry.rishi || '0') || 0);
    return parseFloat(total.toFixed(2)); // Ensure total is a number and formatted
  };

  // Handle input changes for the current month's expenses
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setCurrentExpenses({
      ...currentExpenses,
      [name]: value === '' ? '' : parseFloat(value), // Store as number or empty string
    });
  };

  // Handle adding a new monthly expense entry
  const handleAddExpense = () => {
    if (!currentMonth) {
      alert('Please enter the month.');
      return;
    }

    const newEntry: ExpenseEntry = {
      month: currentMonth,
      lingeshwar: currentExpenses.lingeshwar,
      vani: currentExpenses.vani,
      ruchika: currentExpenses.ruchika,
      rishi: currentExpenses.rishi,
      total: calculateTotal(currentExpenses),
    };

    setExpenses([...expenses, newEntry]);
    // Clear the input fields
    setCurrentMonth('');
    setCurrentExpenses({
      lingeshwar: '',
      vani: '',
      ruchika: '',
      rishi: '',
    });
  };

  // Handle starting the editing process
  const handleEditClick = (index: number) => {
    setEditingIndex(index);
    setEditedExpenses({ ...expenses[index] }); // Create a copy for editing
  };

  // Handle input changes while editing
  const handleEditInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    if (editedExpenses) {
      setEditedExpenses({
        ...editedExpenses,
        [name]: value === '' ? '' : parseFloat(value),
        total: calculateTotal({ // Recalculate total during editing
            ...editedExpenses,
            [name]: value === '' ? '' : parseFloat(value),
          }),
      });
    }
  };

  // Handle saving the edited entry
  const handleSaveEdit = (index: number) => {
    if (editedExpenses) {
      const updatedExpenses = [...expenses];
      updatedExpenses[index] = editedExpenses;
      setExpenses(updatedExpenses);
      setEditingIndex(null); // Exit editing mode
      setEditedExpenses(null);
    }
  };

  // Handle cancelling the editing process
  const handleCancelEdit = () => {
    setEditingIndex(null);
    setEditedExpenses(null);
  };

  // Handle deleting an expense entry
  const handleDeleteClick = (index: number) => {
    const updatedExpenses = expenses.filter((_, i) => i !== index);
    setExpenses(updatedExpenses);
  };

  // Effect to re-calculate total when currentExpenses change
  useEffect(() => {
    // This effect is mainly for initial calculation when inputs are filled
    // Total is recalculated on add and edit input change
  }, [currentExpenses]);


  return (
    <div className="container mx-auto p-4 font-sans">
      <h1 className="text-3xl font-bold text-center mb-6 text-gray-800">Family Expense Tracker</h1>

      {/* Input Form */}
      <div className="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 className="text-2xl font-semibold mb-4 text-gray-700">Add Monthly Expenses</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label htmlFor="month" className="block text-sm font-medium text-gray-700">Month</label>
            <input
              type="text"
              id="month"
              value={currentMonth}
              onChange={(e) => setCurrentMonth(e.target.value)}
              className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2"
              placeholder="e.g., May 2024"
            />
          </div>
        </div>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          {familyMembers.map((member, index) => {
            const nameKey = member.split(' ')[1].toLowerCase() as keyof typeof currentExpenses; // Get key like 'lingeshwar'
            return (
              <div key={index}>
                <label htmlFor={nameKey} className="block text-sm font-medium text-gray-700">{member}</label>
                <input
                  type="number"
                  id={nameKey}
                  name={nameKey}
                  value={currentExpenses[nameKey]}
                  onChange={handleInputChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2"
                  placeholder="Expense amount"
                  min="0"
                />
              </div>
            );
          })}
        </div>
        <button
          onClick={handleAddExpense}
          className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        >
          Add Expense Entry
        </button>
      </div>

      {/* Expense Table */}
      <div className="bg-white shadow-md rounded-lg p-6">
        <h2 className="text-2xl font-semibold mb-4 text-gray-700">Monthly Expenses Summary</h2>
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
            <thead className="bg-gray-50">
              <tr>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Month
                </th>
                {familyMembers.map((member, index) => (
                  <th key={index} scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    {member.split(' ')[1]}
                  </th>
                ))}
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Total
                </th>
                <th scope="col" className="relative px-6 py-3">
                  <span className="sr-only">Edit</span>
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {expenses.map((entry, index) => (
                <tr key={index}>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    {editingIndex === index ? (
                       <input
                         type="text"
                         value={editedExpenses?.month || ''}
                         onChange={(e) => editedExpenses && setEditedExpenses({...editedExpenses, month: e.target.value})}
                         className="rounded-md border-gray-300 shadow-sm sm:text-sm p-1 w-24"
                       />
                    ) : (
                      entry.month
                    )}
                  </td>
                  {familyMembers.map((member, memberIndex) => {
                     const nameKey = member.split(' ')[1].toLowerCase() as keyof typeof currentExpenses;
                    return (
                      <td key={memberIndex} className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {editingIndex === index && editedExpenses ? (
                          <input
                            type="number"
                            name={nameKey}
                            value={editedExpenses[nameKey]}
                            onChange={handleEditInputChange}
                             className="rounded-md border-gray-300 shadow-sm sm:text-sm p-1 w-20"
                            min="0"
                          />
                        ) : (
                          typeof entry[nameKey] === 'number' ? entry[nameKey].toFixed(2) : ''
                        )}
                      </td>
                    );
                  })}
                   <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                     {editingIndex === index && editedExpenses ? (
                       // Display updated total while editing
                       calculateTotal(editedExpenses).toFixed(2)
                     ) : (
                       // Display original total when not editing
                       entry.total.toFixed(2)
                     )}
                   </td>
                  <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    {editingIndex === index ? (
                      <>
                        <button
                          onClick={() => handleSaveEdit(index)}
                          className="text-green-600 hover:text-green-900 mr-3"
                        >
                          Save
                        </button>
                        <button
                          onClick={handleCancelEdit}
                          className="text-gray-600 hover:text-gray-900"
                        >
                          Cancel
                        </button>
                      </>
                    ) : (
                      <>
                        <button
                          onClick={() => handleEditClick(index)}
                          className="text-blue-600 hover:text-blue-900 mr-3"
                        >
                          Edit
                        </button>
                        <button
                          onClick={() => handleDeleteClick(index)}
                          className="text-red-600 hover:text-red-900"
                        >
                          Delete
                        </button>
                      </>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

export default App;
